import streamlit as st
import pandas as pd
import plotly.express as px
#Chargement des données

df_objet_trouve = pd.read_csv("objet_perdus.csv")
frequentation_gare = pd.read_csv("frequentations_gare.csv", delimiter=";")
#Conversion de la colonne "date" au format datetime

df_objet_trouve["date"] = pd.to_datetime(df_objet_trouve["date"])
#Filtrage des données pour les années comprises entre 2019 et 2022 inclus

df_objet_trouve = df_objet_trouve[(df_objet_trouve["date"].dt.year >= 2019) & (df_objet_trouve["date"].dt.year <= 2022)]
#Affichage des types d'objets trouvés pour sélection

objet_types = list(df_objet_trouve["type_objet"].unique())
objet_types_selectionnes = st.multiselect("Sélectionnez les types d'objets à inclure", objet_types, default=objet_types)
#Affichage de l'année pour sélection

annees = list(df_objet_trouve["date"].dt.year.unique())
annee_selectionnee = st.selectbox("Sélectionnez l'année", annees)
#Filtrage des données pour inclure seulement les types d'objets et l'année sélectionnés

df_objet_trouve_filtre = df_objet_trouve[(df_objet_trouve["type_objet"].isin(objet_types_selectionnes)) & (df_objet_trouve["date"].dt.year == annee_selectionnee)]
#Calcul de la somme du nombre d'objets trouvés par gare




df_objet_trouve_par_gare = df_objet_trouve_filtre.groupby(["nom_gare"]).sum().reset_index()
#Merge des deux tables de données pour ajouter les données de fréquentation par gare

df_fusion = pd.merge(df_objet_trouve_par_gare, frequentation_gare, on="nom_gare")
#Création de la carte de Paris avec Plotly

fig = px.scatter_mapbox(df_fusion, lat="Latitude", lon="Longitude", hover_name="nom_gare", hover_data=["sum", "Trafic annuel"], color="sum",
color_continuous_scale=px.colors.sequential.Reds, zoom=11, height=500)
#Configuration de la carte

fig.update_layout(
mapbox_style="carto-positron",
title=f"Répartition du nombre d'objets par gare en {annee_selectionnee} en fonction de la fréquentation de voyageurs",
margin={"r":0,"t":30,"l":0,"b":0},
)
#Affichage de la carte

st.plotly_chart(fig)




